const path = require( 'path' );
const fs = require( 'fs' );
const fsE = require( 'fs-extra' );
const rimraf = require( 'rimraf' );
const pathToInstalledUiComponentsDirectory = "../";
const subModulePath = path.join( pathToInstalledUiComponentsDirectory, "node_modules/@zoho/lyte-ui-plugins/plugins/" );
const pathToParentApp = path.join( pathToInstalledUiComponentsDirectory, "../../../" );
const siblingModulePath = path.join( pathToParentApp, "node_modules/@zoho/lyte-ui-plugins/plugins/" );

function addPlugins() {
    var pathToExtractPluginsFrom = isSubModule() ? subModulePath : siblingModulePath;
	var sourceDir = path.join( __dirname, pathToExtractPluginsFrom );
	var destinationDir = path.join( __dirname, "../plugins" );

    console.log( pathToExtractPluginsFrom );

	if ( fs.existsSync( destinationDir ) ) {
	    rimraf.sync( destinationDir );
	}

	fs.mkdirSync( destinationDir, { recursive: true } );

    if( fs.existsSync( sourceDir ) ) {
        fsE.copySync( sourceDir, destinationDir );
    }
}

function isSubModule() {
    return fs.existsSync( path.join( __dirname, subModulePath ) );
}

addPlugins();