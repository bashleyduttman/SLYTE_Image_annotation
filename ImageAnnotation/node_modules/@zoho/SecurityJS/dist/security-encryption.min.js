!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r(require("@stardazed/streams-compression")):"function"==typeof define&&define.amd?define(["@stardazed/streams-compression"],r):e.ZWAF=r(e.streamsCompression)}(this,function(P){"use strict";function e(e,r,t,n,i,o,c){if(n||!(r in e))return Object.defineProperty&&function(){try{return Object.defineProperty({},"x",{}),1}catch(e){return}}()?(i=!0===i,o=!0===o,c=!0===c,Object.defineProperty(e,r,{value:t,writable:i,configurable:o,enumerable:c})):(e[r]=t,e)}function n(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var r=(function(e,r,t){return r&&n(e.prototype,r),t&&n(e,t),e}(t,[{key:"debug",value:function(){var e;if(window&&window.console&&this.level!==this.LEVELS.NONE&&this.level===this.LEVELS.DEBUG){for(var r=arguments.length,t=Array(r),n=0;n<r;n++)t[n]=arguments[n];(e=window.console).debug.apply(e,t.concat([performance.now()]))}}},{key:"info",value:function(){var e;if(window&&window.console&&this.level!==this.LEVELS.NONE&&!(this.level>this.LEVELS.INFO)){for(var r=arguments.length,t=Array(r),n=0;n<r;n++)t[n]=arguments[n];(e=window.console).log.apply(e,t.concat([performance.now()]))}}},{key:"warn",value:function(){var e;if(window&&window.console&&this.level!==this.LEVELS.NONE&&!(this.level>this.LEVELS.WARN)){for(var r=arguments.length,t=Array(r),n=0;n<r;n++)t[n]=arguments[n];(e=window.console).warn.apply(e,t.concat([performance.now()]))}}},{key:"error",value:function(){var e;if(window&&window.console&&this.level!==this.LEVELS.NONE&&!(this.level>this.LEVELS.ERROR)){for(var r=arguments.length,t=Array(r),n=0;n<r;n++)t[n]=arguments[n];(e=window.console).error.apply(e,t.concat([performance.now()]))}}}]),t);function t(e){!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,t),this.LEVELS={NONE:-1,DEBUG:0,INFO:1,WARN:2,ERROR:3},e===this.LEVELS.NONE||e===this.LEVELS.DEBUG||e===this.LEVELS.INFO||e===this.LEVELS.WARN||e===this.LEVELS.ERROR?this.level=e:this.level=this.LEVELS.ERROR}var i=window&&window.ZWAF?window.ZWAF:{version:"7.0.0"},o=new r;i.defineProperty||(i.defineProperty=e),i.logger||(i.logger=o),i["7_0_0"]||(i["7_0_0"]={version:"7.0.0",defineProperty:e,logger:o});var c=null,a=null,u="csrf",y="param_name",l="cookie_name";function s(){return a=a||this.loadAppAgentConf().then(function(e){return e.json().then(function(e){var r=e&&e[u]&&e[u][y];if(!r)throw Error("Invalid CSRF Param Name in Conf");e=e&&e[u]&&e[u][l];if(!e)throw Error("Invalid CSRF Cookie Name in Conf");return[r,e]})})}var F={setCSRF:function(e){e.paramName&&e.cookieName&&(a=Promise.resolve([e.paramName,e.cookieName]))},getCSRFName:function(){return s().then(function(e){return e[0]})},getCSRFValue:function(){return s().then(function(e){return e[1]})},getCSRFDetails:s,loadAppAgentConf:function(){return c=c||fetch("/waf/appAgentConf").catch(function(e){throw Error("Error while fetching App Agent Conf: "+e)})}};Object.freeze&&Object.freeze(F),"7.0.0"!==i.version||i.configuration||i.defineProperty(i,"configuration",F,!0,!1,!1,!0),i["7_0_0"].configuration||i.defineProperty(i["7_0_0"],"configuration",F,!0,!1,!1,!0);var m=function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,r){var t=[],n=!0,i=!1,o=void 0;try{for(var c,a=e[Symbol.iterator]();!(n=(c=a.next()).done)&&(t.push(c.value),!r||t.length!==r);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(i)throw o}}return t}(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")},o={};function h(e){var r=new TextEncoder;return function(e){var r=e.reduce(function(e,r){return e+r.byteLength},0),t=new Uint8Array(r),n=0,i=!0,o=!1,r=void 0;try{for(var c,a=e[Symbol.iterator]();!(i=(c=a.next()).done);i=!0){var u=c.value;t.set(new Uint8Array(u),n),n+=u.byteLength}}catch(e){o=!0,r=e}finally{try{!i&&a.return&&a.return()}finally{if(o)throw r}}return t}(e.map(function(e){return"string"==typeof e?r.encode(e).buffer:e}))}function B(e,r){!function(e,r,t){var n=2<arguments.length&&void 0!==t?t:{},n=Object.assign({path:"/",SameSite:"lax","max-age":864e7},n);if(encodeURIComponent){var i,o=encodeURIComponent(e)+"="+encodeURIComponent(r);for(i in n){o+="; "+i;var c=n[i];!0!==c&&(o+="="+c)}document.cookie=o}}(e,"",{path:1<arguments.length&&void 0!==r?r:"/","max-age":-1})}function D(e){e+="=";var r=document.cookie,n=void 0;return r.split("; ").forEach(function(r){if(void 0===n){var t=void 0;try{decodeURIComponent&&(t=decodeURIComponent(r))}catch(e){t=r,ZWAF&&ZWAF.logger&&ZWAF.logger.warn&&ZWAF.logger.warn("Error while trying to decode Cookie value!")}0===t.indexOf(e)&&(n=t.substring(e.length))}}),n}function O(e){return D(e)}function N(e){return window&&window.localStorage&&null!=e?window.localStorage.getItem(e):null}function R(e,r){return window&&window.localStorage&&null!=e&&window.localStorage.setItem(e,r)}function x(e){return N(e)}function G(e,r,t,n){if(!r)return e;var i=Object.keys(r);if(!i.length)return e;var o=!0,c=!1,a=void 0;try{for(var u,y=i[Symbol.iterator]();!(o=(u=y.next()).done);o=!0){var l,s=u.value,m=r[s];void 0===e[s]?e[s]=r[s]:t&&(l=e[s],is(l,Object)&&is(m,Object)?G(l,m,t,n):n&&is(l,Array)&&is(m,Array)&&(e[s]=l.concat(m)))}}catch(e){c=!0,a=e}finally{try{!o&&y.return&&y.return()}finally{if(c)throw a}}return e}function g(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}o.createMultipartFormData=function(e){return new Promise(function(o,c){var a=function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r="----WafFormBoundary",t=0;t<=15;t++)r+=e.charAt(Math.floor(Math.random()*e.length));return r}(),u=[],y=Array.from(e.entries());(function r(t){if(t>=y.length){u.push("--"+a+"--");var e={};return e.data=h(u),e.boundary=a,void o(e)}var e=m(y[t],2),n=e[0],i=e[1];i instanceof Blob?i.arrayBuffer().then(function(e){u.push("--"+a+"\r\n",'Content-Disposition: form-data; name="'+n+'"; filename="'+i.name+'"\r\n',"Content-Type: "+i.type+"\r\n","\r\n",e,"\r\n"),r(t+1)}).catch(c):(u.push("--"+a+"\r\n",'Content-Disposition: form-data; name="'+n+'"\r\n',"\r\n",i,"\r\n"),r(t+1))})(0)})},Object.freeze&&Object.freeze(o),"7.0.0"!==i.version||i.RequestUtils||i.defineProperty(i,"RequestUtils",o,!0,!1,!1,!0),i["7_0_0"].RequestUtils||i.defineProperty(i["7_0_0"],"RequestUtils",o,!0,!1,!1,!0);var f={algorithm:"RSA-OAEP",key_hash:"SHA-256",key_size:2048,key_encoding:"Base64",transmission_algorithm:"AES-GCM",publicKeyFormat:"spki",privateKeyFormat:"pkcs8",transmission_key_length:256,transmission_iv_length:12,logLevel:3},L=(function(e,r,t){return r&&g(e.prototype,r),t&&g(e,t),e}(p,[{key:"setLogLevel",value:function(e){this.logger=new r(e)}},{key:"base64ToUint8Array",value:function(e){for(var r=atob(e),t=new Uint8Array(r.length),n=0;n<r.length;n++)t[n]=r.charCodeAt(n);return t}},{key:"uint8ArrayToBase64",value:function(e){for(var r="",t=0;t<e.length;t++)r+=String.fromCharCode(e[t]);return btoa(r)}},{key:"convertToBinary",value:function(e){if(e.constructor===ArrayBuffer)return e;if("string"==typeof e)return(new TextEncoder).encode(e).buffer;if(e.constructor===Uint8Array)return e.buffer;throw new Error("Data cannot be converted to Binary!")}},{key:"exportBinary",value:function(e){var r=this;if(e.constructor===Array)return e.map(function(e){return r.exportBinary(e)});if(e.constructor===ArrayBuffer)return this.uint8ArrayToBase64(new Uint8Array(e));if(e.constructor===Uint8Array)return this.uint8ArrayToBase64(e);throw new Error("Data is not in Binary format!")}},{key:"normalizeBinaryData",value:function(e){if(e.constructor===ArrayBuffer)return e;if("string"==typeof e)return this.base64ToUint8Array(e).buffer;if(e.constructor===Uint8Array)return e.buffer;throw new Error("Data cannot be normalized to Binary!")}},{key:"getAsymmetricEncryptionAlgorithmForGeneration",value:function(e,r){return{name:e||this.asymmetricEncryptionAlgorithm,hash:this.asymmetricEncryptionHash,modulusLength:r||this.asymmetricEncryptionKeySize,publicExponent:new Uint8Array([1,0,1])}}},{key:"getAsymmetricEncryptionAlgorithmForImport",value:function(){return{name:this.asymmetricEncryptionAlgorithm,hash:this.asymmetricEncryptionHash}}},{key:"getAsymmetricEncryptionAlgorithmForUsage",value:function(){return{name:this.asymmetricEncryptionAlgorithm}}},{key:"getSymmetricEncryptionAlgorithmForGeneration",value:function(){return{name:this.symmetricKeyEncryptionAlgorithm,length:this.symmetricKeyLength}}},{key:"getSymmetricEncryptionAlgorithmForImport",value:function(){return{name:this.symmetricKeyEncryptionAlgorithm}}},{key:"getSymmetricEncryptionAlgorithmForUsage",value:function(e){return{name:this.symmetricKeyEncryptionAlgorithm,iv:e}}},{key:"generateAsymmetricKeyPair",value:function(e,r){return crypto.subtle.generateKey(this.getAsymmetricEncryptionAlgorithmForGeneration(e,r),!0,[this.KEY_USAGES.ENCRYPT,this.KEY_USAGES.DECRYPT]).catch(function(e){throw new Error("Failed to generate symmetric key! Error: "+e)})}},{key:"importAsymmetricPublicKey",value:function(e){if(null===e||e.constructor===CryptoKey)return Promise.resolve(e);var e=this.normalizeBinaryData(e),r=this.getAsymmetricEncryptionAlgorithmForImport();return crypto.subtle.importKey(this.asymmetricPublicKeyFormat,e,r,!0,[this.KEY_USAGES.ENCRYPT]).catch(function(e){throw new Error("Failed to import Asymmetric Public Key! Algorithm: "+JSON.stringify(r)+" Error: "+e)})}},{key:"importAsymmetricPrivateKey",value:function(e){if(null===e||e.constructor===CryptoKey)return Promise.resolve(e);var e=this.normalizeBinaryData(e),r=this.getAsymmetricEncryptionAlgorithmForImport();return crypto.subtle.importKey(this.asymmetricPrivateKeyFormat,e,r,!0,[this.KEY_USAGES.DECRYPT]).catch(function(e){throw new Error("Failed to import asymmetric private key! Algorithm: "+JSON.stringify(r)+" Error: "+e)})}},{key:"exportAsymmetricPublicKey",value:function(e){return null===e?Promise.resolve(e):crypto.subtle.exportKey(this.asymmetricPublicKeyFormat,e).catch(function(e){throw new Error("Failed to export asymmetric public key! Error: "+e)})}},{key:"exportAsymmetricPrivateKey",value:function(e){return null===e?Promise.resolve(e):crypto.subtle.exportKey(this.asymmetricPrivateKeyFormat,e).catch(function(e){throw new Error("Failed to export asymmetric private key! Error: "+e)})}},{key:"generateIV",value:function(){return crypto.getRandomValues(new Uint8Array(this.symmetricKeyIVLength))}},{key:"extractIVBytes",value:function(e){return e.slice(e.length-this.symmetricKeyIVLength)}},{key:"extractSymmetricKeyBytes",value:function(e){return e.slice(0,e.length-this.symmetricKeyIVLength)}},{key:"generateSymmetricKey",value:function(){return crypto.subtle.generateKey(this.getSymmetricEncryptionAlgorithmForGeneration(),!0,[this.KEY_USAGES.ENCRYPT,this.KEY_USAGES.DECRYPT]).catch(function(e){throw new Error("Failed to generate symmetric key! Error: "+e)})}},{key:"getSymmetricKey",value:function(e){var r,t,n=this,i=void 0,o=void 0;if(!e||e.constructor!==Object&&e.constructor!==String&&e.constructor!==Uint8Array&&e.constructor!==ArrayBuffer?(i=this.generateSymmetricKey(),o=this.generateIV(),i.then(function(e){n.logger.debug("Symmetric key generated: ",e)})):e.constructor===Object&&e.key&&e.key.constructor===CryptoKey&&e.iv&&e.iv.constructor===Uint8Array?(i=Promise.resolve(e.key),o=e.iv):(r=new Uint8Array(this.normalizeBinaryData(e)),t=this.extractSymmetricKeyBytes(r),o=this.extractIVBytes(r),this.logger.debug("IV Bytes extracted: ",o),(i=this.importSymmetricKey(t)).then(function(e){n.logger.debug("Symmetric key imported: ",e)})),i)return i.then(function(e){return{key:e,iv:o}});this.logger.error("Failed to get symmetric key!",e)}},{key:"importSymmetricKey",value:function(r){var t=this;return crypto.subtle.importKey("raw",r.buffer,this.getSymmetricEncryptionAlgorithmForImport(),!0,[this.KEY_USAGES.ENCRYPT,this.KEY_USAGES.DECRYPT]).catch(function(e){throw t.logger.debug("Encrypted symmetric key bytes: ",r),new Error("Failed to import symmetric key! Error: "+e)})}},{key:"exportSymmetricKey",value:function(e){return crypto.subtle.exportKey("raw",e).catch(function(e){throw new Error("Failed to export symmetric key! Error: "+e)})}},{key:"encryptWithPublicKey",value:function(t,e){var n=this;return this.importAsymmetricPublicKey(e).then(function(e){n.logger.debug("Asymmetric key imported: ",e);var r=n.getAsymmetricEncryptionAlgorithmForUsage();return n._encrypt(t,e,r).catch(function(e){throw new Error("Failed to encrypt the symmetric key with asymmetric public key! Error: "+e)})})}},{key:"decryptWithPrivateKey",value:function(t,e){var n=this;return this.importAsymmetricPrivateKey(e).then(function(e){n.logger.debug("Asymmetric key imported: ",e);var r=n.getAsymmetricEncryptionAlgorithmForUsage();return n._decrypt(t,e,r).catch(function(e){throw n.logger.warn("Failed to decrypt the symmetric key with asymmetric private key! Encrypted symmetric key bytes: ",t),new Error("Failed to decrypt the symmetric key with asymmetric private key! Error: "+e)})})}},{key:"mergeSymmetricKeyAndIV",value:function(e,r){e.constructor===ArrayBuffer&&(e=new Uint8Array(e));var t=new Uint8Array(e.length+r.length);return t.set(e),t.set(r,e.length),t}},{key:"importSymmetricKeyAndIV",value:function(e){var r=this,t=new Uint8Array(e),e=this.extractSymmetricKeyBytes(t),n=this.extractIVBytes(t);return this.logger.debug("IV Bytes extracted: ",n),this.importSymmetricKey(e).then(function(e){return r.logger.debug("AES Key imported: ",e),{key:e,iv:n}})}},{key:"exportSymmetricKeyAndIV",value:function(e,r){var t=this;return this.exportSymmetricKey(e).then(function(e){e=t.mergeSymmetricKeyAndIV(e,r);return t.logger.debug("Symmetric key exported: ",e),e})}},{key:"encryptSymmetricKeyAndIV",value:function(e,r){var t=this;return this.encryptWithPublicKey(e,r).then(function(e){return t.logger.debug("Symmetric key encrypted: ",e),e})}},{key:"decryptSymmetricKeyAndIV",value:function(e,r){var t=this;return this.decryptWithPrivateKey(e,r).then(function(e){return t.logger.debug("AES Key Data decrypted: "),e})}},{key:"_encrypt",value:function(e,r,t){e=this.convertToBinary(e);return crypto.subtle.encrypt(t,r,e)}},{key:"_decrypt",value:function(e,r,t){e=this.normalizeBinaryData(e);return crypto.subtle.decrypt(t,r,e)}},{key:"encrypt",value:function(i,e){var o=this;return this.logger.debug("Encryption started: "),this.getSymmetricKey(e).then(function(e){var t=e.key,e=e.iv,n=o.getSymmetricEncryptionAlgorithmForUsage(e);return o.logger.debug("Symmetric Encryption Algorithm: ",n),o.exportSymmetricKeyAndIV(t,e).then(function(r){var e=(Array.isArray(i)?i:[i]).map(function(e,r){return o.logger.debug("Started encrypting data in "+r+": ",e),o._encrypt(e,t,n).then(function(e){return o.logger.debug("Finished encrypting data in "+r+": ",e),e}).catch(function(e){throw new Error("Failed to encrypt the data using Symmetric Encryption: "+e)})});return Promise.all(e).then(function(e){return o.logger.debug("Encryption finished: "),{key:r,data:1===e.length?e[0]:e}})})})}},{key:"decrypt",value:function(r,e){var i=this;return this.logger.debug("Decryption started: "),this.importSymmetricKeyAndIV(e).then(function(e){var t=e.key,e=e.iv,n=i.getSymmetricEncryptionAlgorithmForUsage(e),e=(r=!Array.isArray(r)?[r]:r).map(function(e,r){return i.logger.debug("Started decrypting data in "+r+": ",e),i._decrypt(e,t,n).then(function(e){return i.logger.debug("Completed decrypting data in "+r+": ",e),e}).catch(function(e){throw new Error("Decryption error! Error: "+e)})});return Promise.all(e).then(function(e){return i.logger.debug("Decryption finished: "),1===e.length?e[0]:e})})}}]),p);function p(e){!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,p),e=G(e||{},f),this.KEY_USAGES={ENCRYPT:"encrypt",DECRYPT:"decrypt"},this.asymmetricEncryptionAlgorithm=e.algorithm,this.asymmetricEncryptionHash=e.key_hash,this.asymmetricEncryptionKeySize=e.key_size,this.asymmetricPublicKeyFormat=e.publicKeyFormat,this.asymmetricPrivateKeyFormat=e.privateKeyFormat,this.symmetricKeyEncryptionAlgorithm=e.transmission_algorithm,this.symmetricKeyLength=e.transmission_key_length,this.symmetricKeyIVLength=e.transmission_iv_length,this.logger=new r(e.logLevel)}var V={privateKey:"MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCIDx6RJqiLUYUOLGBMW2VpmrPnGfnBfH7WWenVyKul0Y3se6LpXJdSf5YwrB7355tM/g3NCzvE2VqJfOAYbi69T3diOfWKtv0M0Xqx0djSr1xpSsO7sYxFAa86Teq/bSwrGBjLrUrTDHoNK3HMYt9u/IMLKGGeZC74KlxWG2kexQS7ADPaUvtt+sbm+4J00hbUZ+6LcCyb+w183zXMPVG5hFC03hyfzVeIDn+wIYP0SCuTIAZordcj+R1E4Nsbf8BgWEUKTJlxvDSSl5tfICV/Z09pZdoBbvru2Lch5lMAiQknskgO7GC0K2EkjEreYGr7k9/jU0i+reDj+aCaKMAhAgMBAAECggEAdZDC8994obGWDDIyH6iVz5OawiWC1zqxCpz03gKgtw6E2QPYOFcGdoXCjFoeBE4/tl6MJFIBmk3J2qVpqhKDFpe0685zKiKGM+5KW56dASf/7QdqbCO1tecHt5SeNDysfqw6uLwLvKO6TujsUxRYRrmwrhJ9j3S31T4dPVZAFhIas9yNCFtVVSoejrsZBTCoccHuOCRzlvYGawBHtRPLQjXfWNjdfcbK6aU7RH3ORagJG3wiJ+GUnlPwwCCxJJaX5E6lYoP/JQfm0S8NOsN57Sm0RpQ7XruU1jSsYPBaoxzu5y5jaOPiSvgndMWBT6Y51Q9TJgH2ef5VzNvhxq94AQKBgQDGCRazu4LhRrm0bY+Ci6T0aqoV18c7lB3K1eKYFUI+dYAJHSoyqKAKG0rV/PxqVzK+rKRLl9+HSIV+G1e2TL9h5oraQAp5p46eXFj+0Lk2y4Z1nVODBmniWMk87/agp7izVLps17mrEaXpA5SyIKo5Sp2mXD3RljcJ+0uUcwjJQQKBgQCv4hnirz7+wq064pU03nWUW9WZHS2OWiDbH+3cqvHMH8mhduQUdz7pasGpH1U0k8PmqWdZBlvWdcZvaQkKdJoPEixOmTrn/ulI8KQEVnOIa4W+fJLctMPBqNZBvQdozq/uX3t3yFmx3YOLyhgPH2ezKVP2yawsOnwAxO6XKQpe4QKBgH6kFUZ+5SWXCu7dGWcMUkKTa41oXdo10A+EU9GZ1rEGhwhNBE09FIsiBOtvSyPd+2+AC9jjmGh08hlA9wh3b/P1cFo9lfVSN5wBxk+9vpPR93yDTYJ+uXur95Tmh7sZRr43srgkBHHnaUfnqFF5HiJhGwvl9Qpwm2Xgs+aM4dOBAoGBAJfHKwVmq5sXjnwRSiccjiTf9vyxpD2C43WVISPbVNwM1mgC/CH5IY42dTan9lRv648iwy+dACWa7wn3fzjJlKTKzvdo3d+UJ+as2y1vGTYxa3INeIMDbyawt2x1Xm6AZmvzc83TVCvcd4drd8WdGVUPpgiC0pQ8SAQ17Zr+bJehAoGADTgia4vtIj14cSkoR0qjK28zkrm4CPmyaB3ds2f3k7C4rrT/Z5j0SmSuv2rj1GfLCg4NrtzNhDkIsW0nIZithu7cClZFM37ZHIevpgCK3h8AV9v1M9mwVxHx8oue2fHTbuW+xZbX6mYF9/QaXqmAbKd1jDriyrgOh0Xn6k/Xet8=",publicKey:"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAiA8ekSaoi1GFDixgTFtlaZqz5xn5wXx+1lnp1cirpdGN7Hui6VyXUn+WMKwe9+ebTP4NzQs7xNlaiXzgGG4uvU93Yjn1irb9DNF6sdHY0q9caUrDu7GMRQGvOk3qv20sKxgYy61K0wx6DStxzGLfbvyDCyhhnmQu+CpcVhtpHsUEuwAz2lL7bfrG5vuCdNIW1Gfui3Asm/sNfN81zD1RuYRQtN4cn81XiA5/sCGD9EgrkyAGaK3XI/kdRODbG3/AYFhFCkyZcbw0kpebXyAlf2dPaWXaAW767ti3IeZTAIkJJ7JIDuxgtCthJIxK3mBq+5Pf41NIvq3g4/mgmijAIQIDAQAB",algorithm:"RSA_2048"},U={privateKey:"MIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIBAQDVDVF6vdb0wKcdJY9G0Oe4X4slqAcZID4Zr1t6GHqTMDU/GTEjWsHgYC5c5vxg+WWP3I0tbLmu7e9Jkz+FIeVFKQz08DoxmPW9/SIvMOlKZzukmGo6r2mR/3OIyT9VICnvIEh2k9GlkiYdOIgOrNpwu+ZSCq6CzTc5YC3p+rpJAi8Fet7Ynan7uI/ysB99HsZnH450rCTMKB1AqBmIDtOgqZs0GqbRyau7BZkZV65jYecZQ0oOi3utkm+1L7U7EixEcZf+AB75TqwMdTIA4uwg3gktoOs8ZDsFgWQfkd10CK8nSs3w6onNqrfcKpiRTKF8qhBdONtPsElqR410572TAgMBAAECggEBAKyV0lhMqnGwEm/Q+kSSe/NmKlEB0WYwMT4bSE4awEi1d5y6qoyKO52oLEaDsxRXU0d7kT2n4q7q/bkrN/x/3brtqxpL88gzsXYLNYLm60SjZbRK51rMuAdV2OCIre4mVPHpw+mSivTF9GwdXFIPAhDqlYQGNSGuXbrzx53PxtHWIaP+nFU/LBMONatyq/h0iNj5HLByLLURgWkPWIiz4W5t4K12OndWAjGenR19DdbnVk5eHWwau1bSZCm750tV+qMemVUVCcSgiiQdzG51rUfvJfTFnyXq0W2qlEKmLFmWfKwrsbk+cE6ZMfE44FxYojywSoKZJ+p2cKRoP1ZGk2ECgYEA6g9hwuMeAW0WnfdnO7NrVSuPsRywRMscArJBA6wJgtnk4OCD1bh+y3obQXafOw5nEUytmOT8LJvCxfqfdL6TsNMglykU4c7ePsbmTo4558iykceI0zD/Dmsr6GncJlG/W9pJE/rXHLKcyVwGlkA141nt6thSRjz0SlK4XC0dEoMCgYEA6QXRH5rsQpBi77FXVHcP9R6GBjy19q5kCro44c8/90qZHwPVCpl50QW63/wNwuk/pnPVBYYV2Q+JVTdYK7xWVWaTlGYdd3ACxM8M/QNsd5vWDGRk2jQTFM7u6bNaxBKgBASDtNXtHK2HIKJCASTXYyQqILs5IlBnAa/iiewje7ECgYBYiCrtQWT3GyEj7RGiNlJR6+E1F+ngi4bzyiLnVapfUTXOjX2wWFG1e2FV2J2QA/meRIehPnPYF66Lnim0SeWpS6KXKpXYd5v+2NMCQa/LaVGJ7JRnda/z7zuzdF8uK1ubTay4nvfAxhqh22ouaOk5LqncW6h7ItEwT6umSfYmKwKBgQCI7QAbYD+gRZO9YSn92hCoao06sQYDtCnZG+A84DmoKE+dp/TRy6mHJ6TN5SB4/fKG7t2n50iDSdvbFTBcUskwWZwywWZjPpCB8WCidBaSmiHHGl8g0SS9P3OoI9ocCQ26DqUN5/7ysQ0MIgxC+9EM0r1mil1iSnicxyuI/BdFoQKBgQDQlKmcSjgft/2EhwN16Ck8+RWQluEG+nmoI/WB+LU56+TQzc3GGXQHjwDnrfX9vGgdBcI62Dk+S+d7HS8YY8XOAPugJ4/G1gABLjniG1N0GyeJmjjP2M+sLmljtxyLVwdz/PXVdT+7mnuwTt3TLEJUcI+EVL4D8oq6L7vwbcYzdQ==",publicKey:"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA1Q1Rer3W9MCnHSWPRtDnuF+LJagHGSA+Ga9behh6kzA1PxkxI1rB4GAuXOb8YPllj9yNLWy5ru3vSZM/hSHlRSkM9PA6MZj1vf0iLzDpSmc7pJhqOq9pkf9ziMk/VSAp7yBIdpPRpZImHTiIDqzacLvmUgqugs03OWAt6fq6SQIvBXre2J2p+7iP8rAffR7GZx+OdKwkzCgdQKgZiA7ToKmbNBqm0cmruwWZGVeuY2HnGUNKDot7rZJvtS+1OxIsRHGX/gAe+U6sDHUyAOLsIN4JLaDrPGQ7BYFkH5HddAivJ0rN8OqJzaq33CqYkUyhfKoQXTjbT7BJakeNdOe9kwIDAQAB",algorithm:"RSA_2048"},T={ORG:"org",COMMON:"common"},W={WAF_ENCRYPTION_HANDSHAKE_URL:"/zwaf/encryption/handshake",WAF_ENCRYPTION_KEY_HEADER:"Waf-Encryption-Key",WAF_ENCRYPTION_ID_HEADER:"Waf-Encryption-Id",WAF_CONTENT_ENCODING_HEADER:"Waf-Content-Encoding"};var Y={clientIDCookie:"_zwaf_enc_clientid",serverIDCookie:"_zwaf_enc_serverid",serverPublicKey:"server-public-key",clientKeyExpiry:"client-id-expiry",clientPublicKey:"client-public-key",clientPrivateKey:"client-private-key",wafEncryptionId:"waf-encryption-id",algorithm:"RSA-OAEP",keySize:2048,scope:T.COMMON,handshakeURL:W.WAF_ENCRYPTION_HANDSHAKE_URL,tag:window&&window.location&&window.location.hostname||"null"},o=function r(t){var a=new L,n=null,i=!1,c=null,u=null,y=null,l=null,s=null,o=!1;function m(r,e,n){return a.encrypt(r,e).then(function(e){var r=e.key,t=e.data;return a.encryptSymmetricKeyAndIV(r,n).then(function(e){return{key:(e=a.exportBinary([e,t]))[0],data:e[1]}})}).then(function(e){return a.logger.debug("Encryption complete: ",r),e}).catch(function(e){throw Error("Error while encrypting data: "+e)})}function h(r,e,t){return a.decryptSymmetricKeyAndIV(e,t).then(function(e){return a.decrypt(r,e)}).catch(function(e){throw Error("Error while decrypting data: "+e)})}function g(c){return new Promise(function(n,r){a.logger.debug("Decompressing data");var e=new Blob([c]),t=new(DecompressionStream||P.DecompressionStream)("gzip"),i=new Response(e).body.pipeThrough(t).getReader(),o=[];return function t(){try{return i.read().then(function(e){var r=e.done,e=e.value;if(!r)return a.logger.debug("Partial decompressed content:",e),o.push(e),t();a.logger.debug("Decompression complete"),n(o)})}catch(e){r("Error while decompressing data: "+e)}}()}).then(function(e){for(var r=0,t=0;t<e.length;t++)r+=e[t].length;for(var n=new Uint8Array(r),i=0,o=0;o<e.length;o++)n.set(e[o],i),i+=e[o].length;return n.buffer})}function f(e,r){var t=Promise.resolve(e);if(r&&!0===r.decompress&&(t=g(e)),r&&!0===r.returnBinary)return t;try{return t.then(function(e){return Array.isArray(e)?e.map(function(e){return(new TextDecoder).decode(e)}):(new TextDecoder).decode(e)})}catch(e){throw a.logger.error(e),a.logger.debug(value),new Error("Failed to decode the decrypted content as string!")}}function p(e){return"_zwaf__"+c.tag+"__"+e}function e(){var e,r,t=void 0,n=!1;return c.scope===T.COMMON?t=u?Promise.resolve(u):v(V):w()&&!o&&(e=N(p(c.serverIDCookie)),r=D(c.serverIDCookie),x(p(c.clientKeyExpiry))&&w()&&x(p(c.clientPrivateKey))&&x(p(c.serverPublicKey))&&x(p(c.clientIDCookie))&&O(c.clientIDCookie)&&e&&r&&e===r)?t=u?Promise.resolve(u):v(A(N(p(c.clientPublicKey)),N(p(c.clientPrivateKey)))):(t=a.generateAsymmetricKeyPair(c.algorithm,c.keySize),n=!0),t.then(function(e){return u=e,a.logger.info("Client Key Pair stored in memory !"),n})}function d(e){var r=!1;return(c.scope===T.COMMON?y?Promise.resolve(y):v(U):e?(r=!0,a.exportAsymmetricPublicKey(u.publicKey).then(function(e){return s=l=null,n=e,i=c.handshakeURL,F.getCSRFDetails().then(function(e){var r=e[0],t=D(e[1]);return(e=new FormData).append("scope",c.scope),e.append("size",c.keySize),e.append("algorithm",c.algorithm),e.append("data",JSON.stringify({"client-public-key":a.exportBinary(n)})),e.append(r,t),fetch(i,{method:"POST",headers:c.handshakeHeaders||{},body:e}).then(function(e){return e.json()}).then(function(e){if(!e[c.serverPublicKey])throw new Error("Failed to fetch Server Public Key!");return e})}).then(function(e){return l=e[c.clientKeyExpiry]||-1,s=e[c.wafEncryptionId]||null,v(A(e[c.serverPublicKey],null))});var n,i})):y?Promise.resolve(y):v(A(N(p(c.serverPublicKey)),null))).then(function(e){return y=e,a.logger.info("Server Key Pair stored in memory !"),r})}function v(e){return a.importAsymmetricPublicKey(e.publicKey).then(function(r){return a.importAsymmetricPrivateKey(e.privateKey).then(function(e){return A(r,e)})})}function A(e,r){return{publicKey:e,privateKey:r}}function E(){return e().then(function(r){return d(r).then(function(e){return e||r?function(){var e=[];try{var r=D(c.serverIDCookie);R(p(c.serverIDCookie),r)}catch(e){a.logger.error("Failed to store Server ID in localStorage!")}try{var t=a.exportAsymmetricPublicKey(y.publicKey).then(function(e){return R(p(c.serverPublicKey),a.exportBinary(e)),!0});e.push(t)}catch(e){a.logger.error("Failed to store Server Public Key in localStorage!")}try{var n=D(c.clientIDCookie);R(p(c.clientIDCookie),n)}catch(e){a.logger.error("Failed to store Client ID in localStorage!")}n=l+Math.floor(Date.now()/1e3);try{R(p(c.clientKeyExpiry),n)}catch(e){a.logger.error("Failed to store Client Expiry time in localStorage!")}try{s&&R(p(c.wafEncryptionId),s)}catch(e){a.logger.error("Failed to store Waf Encryption ID in localStorage!")}try{var i=a.exportAsymmetricPublicKey(u.publicKey).then(function(e){return R(p(c.clientPublicKey),a.exportBinary(e)),!0});e.push(i)}catch(e){a.logger.error("Failed to store Client Public Key in localStorage!")}try{var o=a.exportAsymmetricPrivateKey(u.privateKey).then(function(e){return R(p(c.clientPrivateKey),a.exportBinary(e)),!0});e.push(o)}catch(e){a.logger.error("Failed to store Client Private Key in localStorage!")}return Promise.all(e).then(function(e){return a.logger.info("Key details stored in localStorage!"),!0})}().then(function(e){return e}):(a.logger.debug("Handshake not needed, ignoring this init call!"),!0)})})}function w(){var e=N(p(c.clientKeyExpiry));if(e=Number(e))return e*=1e3,Date.now()<e}function K(){var e=[c.serverIDCookie,c.serverPublicKey,c.clientIDCookie,c.clientKeyExpiry,c.clientPublicKey,c.clientPrivateKey],r=[c.serverIDCookie,c.clientIDCookie];return e.forEach(function(r){var e,t=p(r);try{x(t)&&(e=t,window&&window.localStorage&&null!=e&&window.localStorage.removeItem(e))}catch(e){a.logger.error("Failed to delete "+r+" from localStorage!")}}),r.forEach(function(r){try{O(storageKeyName)&&B(storageKeyName)}catch(e){a.logger.error("Failed to delete "+r+" from localStorage!")}}),!0}function S(e){if(!i)throw new Error("ZWAF Encryption Agent not initialized yet!");return e=(e?u:y).publicKey,Promise.resolve(e)}function b(e){if(!i)throw new Error("ZWAF Encryption Agent not initialized yet!");return e=(c.scope===T.COMMON&&e?y:u).privateKey,Promise.resolve(e)}function k(){if(!i&&!n)throw new Error("ZWAF Encryption Agent not initialized yet!");return n?(a.logger.debug("Handshake in progress so returning the same promise!"),n):n=E().then(function(e){return n=null,i=e})}function C(){return a.getSymmetricKey()}function I(e){return r(e=G(e||{},Y))}return I.SCOPES=T,I.constants=W,I.encrypt=function(r,t){return k().then(function(e){return S().then(function(e){return m(r,t,e)})})},I.decrypt=function(r,t,n){return b().then(function(e){return h(r,t,e).then(function(e){return f(e,n)})})},I.encryptAsServer=function(r,t){return k().then(function(e){return S(!0).then(function(e){return m(r,t,e)})})},I.decryptAsServer=function(r,t,n){return b(!0).then(function(e){return h(r,t,e).then(function(e){return f(e,n)})})},I.init=function(e){return c=G(e||{},t),i&&a.logger.warn("Already initialized! Is this call really necessary?"),n?(a.logger.debug("Init in progress so returning the same promise!"),n):n=E().then(function(e){return n=null,i=e})},I.reInit=function(e){return o=!0,c=G(e||{},t),a.logger.warn("Using forced handshake!"),K(),n=E().then(function(e){return n=null,o=!1,i=e})},I.deleteHandshakeDetails=K,I.getKey=function(){return C().then(function(r){return k().then(function(e){return a.exportSymmetricKeyAndIV(r.key,r.iv).then(function(r){return S().then(function(e){return a.encryptSymmetricKeyAndIV(r,e).then(function(e){return a.exportBinary(e)})})})})})},I.getReusableKey=C,I.setLogLevel=function(e){a.setLogLevel(e)},I.getEncryptAgent=function(){return a},I.getWafEncryptionId=function(){if(!i&&!n)throw new Error("ZWAF Encryption Agent not initialized yet!");return n?(a.logger.debug("Handshake in progress. Please call after Handshake is complete!"),null):N(p(c.wafEncryptionId))},I.getPublicKey=S,I.getPrivateKey=b,I}(Y);return Object.freeze&&Object.freeze(o),"7.0.0"!==i.version||i.Encryption||i.defineProperty(i,"Encryption",o,!0,!1,!1,!0),i["7_0_0"].Encryption||i.defineProperty(i["7_0_0"],"Encryption",o,!0,!1,!1,!0),i});
